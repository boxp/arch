---
# upgrade_kubelet_kubectl.yml â€” Upgrade kubelet and kubectl packages

- name: Unhold kubelet and kubectl
  ansible.builtin.dpkg_selections:
    name: "{{ item }}"
    selection: install
  loop:
    - kubelet
    - kubectl
  become: true
  tags: [upgrade]

- name: Install target kubelet and kubectl versions
  ansible.builtin.apt:
    name:
      - "kubelet={{ kubernetes_upgrade_package }}"
      - "kubectl={{ kubernetes_upgrade_package }}"
    state: present
    allow_downgrade: false
  become: true
  tags: [upgrade]

- name: Hold kubelet and kubectl
  ansible.builtin.dpkg_selections:
    name: "{{ item }}"
    selection: hold
  loop:
    - kubelet
    - kubectl
  become: true
  tags: [upgrade]
